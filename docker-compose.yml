version: '3.8'
x-app-env:
  environment:
    - 'NGINX_PORT=${NGINX_PORT}'
    - 'WEB_URL=${WEB_URL}'
    - 'DEBUG=${DEBUG}'
    - 'DJANGO_SETTINGS_MODULE=${DJANGO_SETTINGS_MODULE}'
    - 'NEXT_PUBLIC_DEPLOY_URL=${NEXT_PUBLIC_DEPLOY_URL}'
    - 'SENTRY_DSN=${SENTRY_DSN}'
    - 'SENTRY_ENVIRONMENT=${SENTRY_ENVIRONMENT}'
    - 'GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}'
    - 'GITHUB_CLIENT_ID=${GITHUB_CLIENT_ID}'
    - 'GITHUB_CLIENT_SECRET=${GITHUB_CLIENT_SECRET}'
    - 'DOCKERIZED=${DOCKERIZED}'
    - 'CORS_ALLOWED_ORIGINS=${CORS_ALLOWED_ORIGINS}'
    - 'GUNICORN_WORKERS=${GUNICORN_WORKERS}'
    - 'PGHOST=${PGHOST}'
    - 'PGDATABASE=${PGDATABASE}'
    - 'POSTGRES_USER=${POSTGRES_USER}'
    - 'POSTGRES_PASSWORD=${POSTGRES_PASSWORD}'
    - 'POSTGRES_DB=${POSTGRES_DB}'
    - 'PGDATA=${PGDATA}'
    - 'DATABASE_URL=${DATABASE_URL}'
    - 'REDIS_HOST=${REDIS_HOST}'
    - 'REDIS_PORT=${REDIS_PORT}'
    - 'REDIS_URL=${REDIS_URL}'
    - 'EMAIL_HOST=${EMAIL_HOST}'
    - 'EMAIL_HOST_USER=${EMAIL_HOST_USER}'
    - 'EMAIL_HOST_PASSWORD=${EMAIL_HOST_PASSWORD}'
    - 'EMAIL_PORT=${EMAIL_PORT}'
    - 'EMAIL_FROM=${EMAIL_FROM}'
    - 'EMAIL_USE_TLS=${EMAIL_USE_TLS}'
    - 'EMAIL_USE_SSL=${EMAIL_USE_SSL}'
    - 'DEFAULT_EMAIL=${DEFAULT_EMAIL}'
    - 'DEFAULT_PASSWORD=${DEFAULT_PASSWORD}'
    - 'OPENAI_API_BASE=${OPENAI_API_BASE}'
    - 'OPENAI_API_KEY=${OPENAI_API_KEY}'
    - 'GPT_ENGINE=${GPT_ENGINE}'
    - 'ENABLE_SIGNUP=${ENABLE_SIGNUP}'
    - 'ENABLE_EMAIL_PASSWORD=${ENABLE_EMAIL_PASSWORD}'
    - 'ENABLE_MAGIC_LINK_LOGIN=${ENABLE_MAGIC_LINK_LOGIN}'
    - 'SECRET_KEY=${SECRET_KEY}'
    - 'USE_MINIO=${USE_MINIO}'
    - 'AWS_REGION=${AWS_REGION}'
    - 'AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}'
    - 'AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}'
    - 'AWS_S3_ENDPOINT_URL=${AWS_S3_ENDPOINT_URL}'
    - 'AWS_S3_BUCKET_NAME=${AWS_S3_BUCKET_NAME}'
    - 'MINIO_ROOT_USER=${MINIO_ROOT_USER}'
    - 'MINIO_ROOT_PASSWORD=${MINIO_ROOT_PASSWORD}'
    - 'BUCKET_NAME=${BUCKET_NAME}'
    - 'FILE_SIZE_LIMIT=${FILE_SIZE_LIMIT}'
services:
  web:
    environment:
      - 'NGINX_PORT=${NGINX_PORT}'
      - 'WEB_URL=${WEB_URL}'
      - 'DEBUG=${DEBUG}'
      - 'DJANGO_SETTINGS_MODULE=${DJANGO_SETTINGS_MODULE}'
      - 'NEXT_PUBLIC_DEPLOY_URL=${NEXT_PUBLIC_DEPLOY_URL}'
      - 'SENTRY_DSN=${SENTRY_DSN}'
      - 'SENTRY_ENVIRONMENT=${SENTRY_ENVIRONMENT}'
      - 'GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}'
      - 'GITHUB_CLIENT_ID=${GITHUB_CLIENT_ID}'
      - 'GITHUB_CLIENT_SECRET=${GITHUB_CLIENT_SECRET}'
      - 'DOCKERIZED=${DOCKERIZED}'
      - 'CORS_ALLOWED_ORIGINS=${CORS_ALLOWED_ORIGINS}'
      - 'GUNICORN_WORKERS=${GUNICORN_WORKERS}'
      - 'PGHOST=${PGHOST}'
      - 'PGDATABASE=${PGDATABASE}'
      - 'POSTGRES_USER=${POSTGRES_USER}'
      - 'POSTGRES_PASSWORD=${POSTGRES_PASSWORD}'
      - 'POSTGRES_DB=${POSTGRES_DB}'
      - 'PGDATA=${PGDATA}'
      - 'DATABASE_URL=${DATABASE_URL}'
      - 'REDIS_HOST=${REDIS_HOST}'
      - 'REDIS_PORT=${REDIS_PORT}'
      - 'REDIS_URL=${REDIS_URL}'
      - 'EMAIL_HOST=${EMAIL_HOST}'
      - 'EMAIL_HOST_USER=${EMAIL_HOST_USER}'
      - 'EMAIL_HOST_PASSWORD=${EMAIL_HOST_PASSWORD}'
      - 'EMAIL_PORT=${EMAIL_PORT}'
      - 'EMAIL_FROM=${EMAIL_FROM}'
      - 'EMAIL_USE_TLS=${EMAIL_USE_TLS}'
      - 'EMAIL_USE_SSL=${EMAIL_USE_SSL}'
      - 'DEFAULT_EMAIL=${DEFAULT_EMAIL}'
      - 'DEFAULT_PASSWORD=${DEFAULT_PASSWORD}'
      - 'OPENAI_API_BASE=${OPENAI_API_BASE}'
      - 'OPENAI_API_KEY=${OPENAI_API_KEY}'
      - 'GPT_ENGINE=${GPT_ENGINE}'
      - 'ENABLE_SIGNUP=${ENABLE_SIGNUP}'
      - 'ENABLE_EMAIL_PASSWORD=${ENABLE_EMAIL_PASSWORD}'
      - 'ENABLE_MAGIC_LINK_LOGIN=${ENABLE_MAGIC_LINK_LOGIN}'
      - 'SECRET_KEY=${SECRET_KEY}'
      - 'USE_MINIO=${USE_MINIO}'
      - 'AWS_REGION=${AWS_REGION}'
      - 'AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}'
      - 'AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}'
      - 'AWS_S3_ENDPOINT_URL=${AWS_S3_ENDPOINT_URL}'
      - 'AWS_S3_BUCKET_NAME=${AWS_S3_BUCKET_NAME}'
      - 'MINIO_ROOT_USER=${MINIO_ROOT_USER}'
      - 'MINIO_ROOT_PASSWORD=${MINIO_ROOT_PASSWORD}'
      - 'BUCKET_NAME=${BUCKET_NAME}'
      - 'FILE_SIZE_LIMIT=${FILE_SIZE_LIMIT}'
    image: 'makeplane/plane-frontend:latest'
    pull_policy: always
    restart: unless-stopped
    command: 'node web/server.js web'
    deploy:
      replicas: '${WEB_REPLICAS}'
    depends_on:
      - api
      - worker
  admin:
    image: makeplane/plane-admin
    pull_policy: always
    restart: unless-stopped
    command: 'node admin/server.js admin'
    depends_on:
      - api
      - web
  space:
    environment:
      - 'NGINX_PORT=${NGINX_PORT}'
      - 'WEB_URL=${WEB_URL}'
      - 'DEBUG=${DEBUG}'
      - 'DJANGO_SETTINGS_MODULE=${DJANGO_SETTINGS_MODULE}'
      - 'NEXT_PUBLIC_DEPLOY_URL=${NEXT_PUBLIC_DEPLOY_URL}'
      - 'SENTRY_DSN=${SENTRY_DSN}'
      - 'SENTRY_ENVIRONMENT=${SENTRY_ENVIRONMENT}'
      - 'GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}'
      - 'GITHUB_CLIENT_ID=${GITHUB_CLIENT_ID}'
      - 'GITHUB_CLIENT_SECRET=${GITHUB_CLIENT_SECRET}'
      - 'DOCKERIZED=${DOCKERIZED}'
      - 'CORS_ALLOWED_ORIGINS=${CORS_ALLOWED_ORIGINS}'
      - 'GUNICORN_WORKERS=${GUNICORN_WORKERS}'
      - 'PGHOST=${PGHOST}'
      - 'PGDATABASE=${PGDATABASE}'
      - 'POSTGRES_USER=${POSTGRES_USER}'
      - 'POSTGRES_PASSWORD=${POSTGRES_PASSWORD}'
      - 'POSTGRES_DB=${POSTGRES_DB}'
      - 'PGDATA=${PGDATA}'
      - 'DATABASE_URL=${DATABASE_URL}'
      - 'REDIS_HOST=${REDIS_HOST}'
      - 'REDIS_PORT=${REDIS_PORT}'
      - 'REDIS_URL=${REDIS_URL}'
      - 'EMAIL_HOST=${EMAIL_HOST}'
      - 'EMAIL_HOST_USER=${EMAIL_HOST_USER}'
      - 'EMAIL_HOST_PASSWORD=${EMAIL_HOST_PASSWORD}'
      - 'EMAIL_PORT=${EMAIL_PORT}'
      - 'EMAIL_FROM=${EMAIL_FROM}'
      - 'EMAIL_USE_TLS=${EMAIL_USE_TLS}'
      - 'EMAIL_USE_SSL=${EMAIL_USE_SSL}'
      - 'DEFAULT_EMAIL=${DEFAULT_EMAIL}'
      - 'DEFAULT_PASSWORD=${DEFAULT_PASSWORD}'
      - 'OPENAI_API_BASE=${OPENAI_API_BASE}'
      - 'OPENAI_API_KEY=${OPENAI_API_KEY}'
      - 'GPT_ENGINE=${GPT_ENGINE}'
      - 'ENABLE_SIGNUP=${ENABLE_SIGNUP}'
      - 'ENABLE_EMAIL_PASSWORD=${ENABLE_EMAIL_PASSWORD}'
      - 'ENABLE_MAGIC_LINK_LOGIN=${ENABLE_MAGIC_LINK_LOGIN}'
      - 'SECRET_KEY=${SECRET_KEY}'
      - 'USE_MINIO=${USE_MINIO}'
      - 'AWS_REGION=${AWS_REGION}'
      - 'AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}'
      - 'AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}'
      - 'AWS_S3_ENDPOINT_URL=${AWS_S3_ENDPOINT_URL}'
      - 'AWS_S3_BUCKET_NAME=${AWS_S3_BUCKET_NAME}'
      - 'MINIO_ROOT_USER=${MINIO_ROOT_USER}'
      - 'MINIO_ROOT_PASSWORD=${MINIO_ROOT_PASSWORD}'
      - 'BUCKET_NAME=${BUCKET_NAME}'
      - 'FILE_SIZE_LIMIT=${FILE_SIZE_LIMIT}'
    image: 'makeplane/plane-space:latest'
    pull_policy: always
    restart: unless-stopped
    command: 'node space/server.js space'
    deploy:
      replicas: '${SPACE_REPLICAS}'
    depends_on:
      - api
      - worker
      - web
  api:
    environment:
      - 'NGINX_PORT=${NGINX_PORT}'
      - 'WEB_URL=${WEB_URL}'
      - 'DEBUG=${DEBUG}'
      - 'DJANGO_SETTINGS_MODULE=${DJANGO_SETTINGS_MODULE}'
      - 'NEXT_PUBLIC_DEPLOY_URL=${NEXT_PUBLIC_DEPLOY_URL}'
      - 'SENTRY_DSN=${SENTRY_DSN}'
      - 'SENTRY_ENVIRONMENT=${SENTRY_ENVIRONMENT}'
      - 'GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}'
      - 'GITHUB_CLIENT_ID=${GITHUB_CLIENT_ID}'
      - 'GITHUB_CLIENT_SECRET=${GITHUB_CLIENT_SECRET}'
      - 'DOCKERIZED=${DOCKERIZED}'
      - 'CORS_ALLOWED_ORIGINS=${CORS_ALLOWED_ORIGINS}'
      - 'GUNICORN_WORKERS=${GUNICORN_WORKERS}'
      - 'PGHOST=${PGHOST}'
      - 'PGDATABASE=${PGDATABASE}'
      - 'POSTGRES_USER=${POSTGRES_USER}'
      - 'POSTGRES_PASSWORD=${POSTGRES_PASSWORD}'
      - 'POSTGRES_DB=${POSTGRES_DB}'
      - 'PGDATA=${PGDATA}'
      - 'DATABASE_URL=${DATABASE_URL}'
      - 'REDIS_HOST=${REDIS_HOST}'
      - 'REDIS_PORT=${REDIS_PORT}'
      - 'REDIS_URL=${REDIS_URL}'
      - 'EMAIL_HOST=${EMAIL_HOST}'
      - 'EMAIL_HOST_USER=${EMAIL_HOST_USER}'
      - 'EMAIL_HOST_PASSWORD=${EMAIL_HOST_PASSWORD}'
      - 'EMAIL_PORT=${EMAIL_PORT}'
      - 'EMAIL_FROM=${EMAIL_FROM}'
      - 'EMAIL_USE_TLS=${EMAIL_USE_TLS}'
      - 'EMAIL_USE_SSL=${EMAIL_USE_SSL}'
      - 'DEFAULT_EMAIL=${DEFAULT_EMAIL}'
      - 'DEFAULT_PASSWORD=${DEFAULT_PASSWORD}'
      - 'OPENAI_API_BASE=${OPENAI_API_BASE}'
      - 'OPENAI_API_KEY=${OPENAI_API_KEY}'
      - 'GPT_ENGINE=${GPT_ENGINE}'
      - 'ENABLE_SIGNUP=${ENABLE_SIGNUP}'
      - 'ENABLE_EMAIL_PASSWORD=${ENABLE_EMAIL_PASSWORD}'
      - 'ENABLE_MAGIC_LINK_LOGIN=${ENABLE_MAGIC_LINK_LOGIN}'
      - 'SECRET_KEY=${SECRET_KEY}'
      - 'USE_MINIO=${USE_MINIO}'
      - 'AWS_REGION=${AWS_REGION}'
      - 'AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}'
      - 'AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}'
      - 'AWS_S3_ENDPOINT_URL=${AWS_S3_ENDPOINT_URL}'
      - 'AWS_S3_BUCKET_NAME=${AWS_S3_BUCKET_NAME}'
      - 'MINIO_ROOT_USER=${MINIO_ROOT_USER}'
      - 'MINIO_ROOT_PASSWORD=${MINIO_ROOT_PASSWORD}'
      - 'BUCKET_NAME=${BUCKET_NAME}'
      - 'FILE_SIZE_LIMIT=${FILE_SIZE_LIMIT}'
    image: 'makeplane/plane-backend:latest'
    pull_policy: always
    restart: unless-stopped
    command: ./bin/docker-entrypoint-api.sh
    deploy:
      replicas: '${API_REPLICAS}'
    depends_on:
      - plane-db
      - plane-redis
    ports:
      - '8003:8000'
  worker:
    environment:
      - 'NGINX_PORT=${NGINX_PORT}'
      - 'WEB_URL=${WEB_URL}'
      - 'DEBUG=${DEBUG}'
      - 'DJANGO_SETTINGS_MODULE=${DJANGO_SETTINGS_MODULE}'
      - 'NEXT_PUBLIC_DEPLOY_URL=${NEXT_PUBLIC_DEPLOY_URL}'
      - 'SENTRY_DSN=${SENTRY_DSN}'
      - 'SENTRY_ENVIRONMENT=${SENTRY_ENVIRONMENT}'
      - 'GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}'
      - 'GITHUB_CLIENT_ID=${GITHUB_CLIENT_ID}'
      - 'GITHUB_CLIENT_SECRET=${GITHUB_CLIENT_SECRET}'
      - 'DOCKERIZED=${DOCKERIZED}'
      - 'CORS_ALLOWED_ORIGINS=${CORS_ALLOWED_ORIGINS}'
      - 'GUNICORN_WORKERS=${GUNICORN_WORKERS}'
      - 'PGHOST=${PGHOST}'
      - 'PGDATABASE=${PGDATABASE}'
      - 'POSTGRES_USER=${POSTGRES_USER}'
      - 'POSTGRES_PASSWORD=${POSTGRES_PASSWORD}'
      - 'POSTGRES_DB=${POSTGRES_DB}'
      - 'PGDATA=${PGDATA}'
      - 'DATABASE_URL=${DATABASE_URL}'
      - 'REDIS_HOST=${REDIS_HOST}'
      - 'REDIS_PORT=${REDIS_PORT}'
      - 'REDIS_URL=${REDIS_URL}'
      - 'EMAIL_HOST=${EMAIL_HOST}'
      - 'EMAIL_HOST_USER=${EMAIL_HOST_USER}'
      - 'EMAIL_HOST_PASSWORD=${EMAIL_HOST_PASSWORD}'
      - 'EMAIL_PORT=${EMAIL_PORT}'
      - 'EMAIL_FROM=${EMAIL_FROM}'
      - 'EMAIL_USE_TLS=${EMAIL_USE_TLS}'
      - 'EMAIL_USE_SSL=${EMAIL_USE_SSL}'
      - 'DEFAULT_EMAIL=${DEFAULT_EMAIL}'
      - 'DEFAULT_PASSWORD=${DEFAULT_PASSWORD}'
      - 'OPENAI_API_BASE=${OPENAI_API_BASE}'
      - 'OPENAI_API_KEY=${OPENAI_API_KEY}'
      - 'GPT_ENGINE=${GPT_ENGINE}'
      - 'ENABLE_SIGNUP=${ENABLE_SIGNUP}'
      - 'ENABLE_EMAIL_PASSWORD=${ENABLE_EMAIL_PASSWORD}'
      - 'ENABLE_MAGIC_LINK_LOGIN=${ENABLE_MAGIC_LINK_LOGIN}'
      - 'SECRET_KEY=${SECRET_KEY}'
      - 'USE_MINIO=${USE_MINIO}'
      - 'AWS_REGION=${AWS_REGION}'
      - 'AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}'
      - 'AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}'
      - 'AWS_S3_ENDPOINT_URL=${AWS_S3_ENDPOINT_URL}'
      - 'AWS_S3_BUCKET_NAME=${AWS_S3_BUCKET_NAME}'
      - 'MINIO_ROOT_USER=${MINIO_ROOT_USER}'
      - 'MINIO_ROOT_PASSWORD=${MINIO_ROOT_PASSWORD}'
      - 'BUCKET_NAME=${BUCKET_NAME}'
      - 'FILE_SIZE_LIMIT=${FILE_SIZE_LIMIT}'
    image: 'makeplane/plane-backend:latest'
    pull_policy: always
    restart: unless-stopped
    command: ./bin/docker-entrypoint-worker.sh
    depends_on:
      - api
      - plane-db
      - plane-redis
  beat-worker:
    environment:
      - 'NGINX_PORT=${NGINX_PORT}'
      - 'WEB_URL=${WEB_URL}'
      - 'DEBUG=${DEBUG}'
      - 'DJANGO_SETTINGS_MODULE=${DJANGO_SETTINGS_MODULE}'
      - 'NEXT_PUBLIC_DEPLOY_URL=${NEXT_PUBLIC_DEPLOY_URL}'
      - 'SENTRY_DSN=${SENTRY_DSN}'
      - 'SENTRY_ENVIRONMENT=${SENTRY_ENVIRONMENT}'
      - 'GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}'
      - 'GITHUB_CLIENT_ID=${GITHUB_CLIENT_ID}'
      - 'GITHUB_CLIENT_SECRET=${GITHUB_CLIENT_SECRET}'
      - 'DOCKERIZED=${DOCKERIZED}'
      - 'CORS_ALLOWED_ORIGINS=${CORS_ALLOWED_ORIGINS}'
      - 'GUNICORN_WORKERS=${GUNICORN_WORKERS}'
      - 'PGHOST=${PGHOST}'
      - 'PGDATABASE=${PGDATABASE}'
      - 'POSTGRES_USER=${POSTGRES_USER}'
      - 'POSTGRES_PASSWORD=${POSTGRES_PASSWORD}'
      - 'POSTGRES_DB=${POSTGRES_DB}'
      - 'PGDATA=${PGDATA}'
      - 'DATABASE_URL=${DATABASE_URL}'
      - 'REDIS_HOST=${REDIS_HOST}'
      - 'REDIS_PORT=${REDIS_PORT}'
      - 'REDIS_URL=${REDIS_URL}'
      - 'EMAIL_HOST=${EMAIL_HOST}'
      - 'EMAIL_HOST_USER=${EMAIL_HOST_USER}'
      - 'EMAIL_HOST_PASSWORD=${EMAIL_HOST_PASSWORD}'
      - 'EMAIL_PORT=${EMAIL_PORT}'
      - 'EMAIL_FROM=${EMAIL_FROM}'
      - 'EMAIL_USE_TLS=${EMAIL_USE_TLS}'
      - 'EMAIL_USE_SSL=${EMAIL_USE_SSL}'
      - 'DEFAULT_EMAIL=${DEFAULT_EMAIL}'
      - 'DEFAULT_PASSWORD=${DEFAULT_PASSWORD}'
      - 'OPENAI_API_BASE=${OPENAI_API_BASE}'
      - 'OPENAI_API_KEY=${OPENAI_API_KEY}'
      - 'GPT_ENGINE=${GPT_ENGINE}'
      - 'ENABLE_SIGNUP=${ENABLE_SIGNUP}'
      - 'ENABLE_EMAIL_PASSWORD=${ENABLE_EMAIL_PASSWORD}'
      - 'ENABLE_MAGIC_LINK_LOGIN=${ENABLE_MAGIC_LINK_LOGIN}'
      - 'SECRET_KEY=${SECRET_KEY}'
      - 'USE_MINIO=${USE_MINIO}'
      - 'AWS_REGION=${AWS_REGION}'
      - 'AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}'
      - 'AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}'
      - 'AWS_S3_ENDPOINT_URL=${AWS_S3_ENDPOINT_URL}'
      - 'AWS_S3_BUCKET_NAME=${AWS_S3_BUCKET_NAME}'
      - 'MINIO_ROOT_USER=${MINIO_ROOT_USER}'
      - 'MINIO_ROOT_PASSWORD=${MINIO_ROOT_PASSWORD}'
      - 'BUCKET_NAME=${BUCKET_NAME}'
      - 'FILE_SIZE_LIMIT=${FILE_SIZE_LIMIT}'
    image: 'makeplane/plane-backend:latest'
    pull_policy: always
    restart: unless-stopped
    command: ./bin/docker-entrypoint-beat.sh
    depends_on:
      - api
      - plane-db
      - plane-redis
  migrator:
    environment:
      - 'NGINX_PORT=${NGINX_PORT}'
      - 'WEB_URL=${WEB_URL}'
      - 'DEBUG=${DEBUG}'
      - 'DJANGO_SETTINGS_MODULE=${DJANGO_SETTINGS_MODULE}'
      - 'NEXT_PUBLIC_DEPLOY_URL=${NEXT_PUBLIC_DEPLOY_URL}'
      - 'SENTRY_DSN=${SENTRY_DSN}'
      - 'SENTRY_ENVIRONMENT=${SENTRY_ENVIRONMENT}'
      - 'GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}'
      - 'GITHUB_CLIENT_ID=${GITHUB_CLIENT_ID}'
      - 'GITHUB_CLIENT_SECRET=${GITHUB_CLIENT_SECRET}'
      - 'DOCKERIZED=${DOCKERIZED}'
      - 'CORS_ALLOWED_ORIGINS=${CORS_ALLOWED_ORIGINS}'
      - 'GUNICORN_WORKERS=${GUNICORN_WORKERS}'
      - 'PGHOST=${PGHOST}'
      - 'PGDATABASE=${PGDATABASE}'
      - 'POSTGRES_USER=${POSTGRES_USER}'
      - 'POSTGRES_PASSWORD=${POSTGRES_PASSWORD}'
      - 'POSTGRES_DB=${POSTGRES_DB}'
      - 'PGDATA=${PGDATA}'
      - 'DATABASE_URL=${DATABASE_URL}'
      - 'REDIS_HOST=${REDIS_HOST}'
      - 'REDIS_PORT=${REDIS_PORT}'
      - 'REDIS_URL=${REDIS_URL}'
      - 'EMAIL_HOST=${EMAIL_HOST}'
      - 'EMAIL_HOST_USER=${EMAIL_HOST_USER}'
      - 'EMAIL_HOST_PASSWORD=${EMAIL_HOST_PASSWORD}'
      - 'EMAIL_PORT=${EMAIL_PORT}'
      - 'EMAIL_FROM=${EMAIL_FROM}'
      - 'EMAIL_USE_TLS=${EMAIL_USE_TLS}'
      - 'EMAIL_USE_SSL=${EMAIL_USE_SSL}'
      - 'DEFAULT_EMAIL=${DEFAULT_EMAIL}'
      - 'DEFAULT_PASSWORD=${DEFAULT_PASSWORD}'
      - 'OPENAI_API_BASE=${OPENAI_API_BASE}'
      - 'OPENAI_API_KEY=${OPENAI_API_KEY}'
      - 'GPT_ENGINE=${GPT_ENGINE}'
      - 'ENABLE_SIGNUP=${ENABLE_SIGNUP}'
      - 'ENABLE_EMAIL_PASSWORD=${ENABLE_EMAIL_PASSWORD}'
      - 'ENABLE_MAGIC_LINK_LOGIN=${ENABLE_MAGIC_LINK_LOGIN}'
      - 'SECRET_KEY=${SECRET_KEY}'
      - 'USE_MINIO=${USE_MINIO}'
      - 'AWS_REGION=${AWS_REGION}'
      - 'AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}'
      - 'AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}'
      - 'AWS_S3_ENDPOINT_URL=${AWS_S3_ENDPOINT_URL}'
      - 'AWS_S3_BUCKET_NAME=${AWS_S3_BUCKET_NAME}'
      - 'MINIO_ROOT_USER=${MINIO_ROOT_USER}'
      - 'MINIO_ROOT_PASSWORD=${MINIO_ROOT_PASSWORD}'
      - 'BUCKET_NAME=${BUCKET_NAME}'
      - 'FILE_SIZE_LIMIT=${FILE_SIZE_LIMIT}'
    image: 'makeplane/plane-backend:latest'
    pull_policy: always
    restart: 'no'
    command: "sh -c \"python manage.py wait_for_db &&\n     python manage.py migrate\"\n"
    depends_on:
      - plane-db
      - plane-redis
  plane-db:
    environment:
      - 'NGINX_PORT=${NGINX_PORT}'
      - 'WEB_URL=${WEB_URL}'
      - 'DEBUG=${DEBUG}'
      - 'DJANGO_SETTINGS_MODULE=${DJANGO_SETTINGS_MODULE}'
      - 'NEXT_PUBLIC_DEPLOY_URL=${NEXT_PUBLIC_DEPLOY_URL}'
      - 'SENTRY_DSN=${SENTRY_DSN}'
      - 'SENTRY_ENVIRONMENT=${SENTRY_ENVIRONMENT}'
      - 'GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}'
      - 'GITHUB_CLIENT_ID=${GITHUB_CLIENT_ID}'
      - 'GITHUB_CLIENT_SECRET=${GITHUB_CLIENT_SECRET}'
      - 'DOCKERIZED=${DOCKERIZED}'
      - 'CORS_ALLOWED_ORIGINS=${CORS_ALLOWED_ORIGINS}'
      - 'GUNICORN_WORKERS=${GUNICORN_WORKERS}'
      - 'PGHOST=${PGHOST}'
      - 'PGDATABASE=${PGDATABASE}'
      - 'POSTGRES_USER=${POSTGRES_USER}'
      - 'POSTGRES_PASSWORD=${POSTGRES_PASSWORD}'
      - 'POSTGRES_DB=${POSTGRES_DB}'
      - 'PGDATA=${PGDATA}'
      - 'DATABASE_URL=${DATABASE_URL}'
      - 'REDIS_HOST=${REDIS_HOST}'
      - 'REDIS_PORT=${REDIS_PORT}'
      - 'REDIS_URL=${REDIS_URL}'
      - 'EMAIL_HOST=${EMAIL_HOST}'
      - 'EMAIL_HOST_USER=${EMAIL_HOST_USER}'
      - 'EMAIL_HOST_PASSWORD=${EMAIL_HOST_PASSWORD}'
      - 'EMAIL_PORT=${EMAIL_PORT}'
      - 'EMAIL_FROM=${EMAIL_FROM}'
      - 'EMAIL_USE_TLS=${EMAIL_USE_TLS}'
      - 'EMAIL_USE_SSL=${EMAIL_USE_SSL}'
      - 'DEFAULT_EMAIL=${DEFAULT_EMAIL}'
      - 'DEFAULT_PASSWORD=${DEFAULT_PASSWORD}'
      - 'OPENAI_API_BASE=${OPENAI_API_BASE}'
      - 'OPENAI_API_KEY=${OPENAI_API_KEY}'
      - 'GPT_ENGINE=${GPT_ENGINE}'
      - 'ENABLE_SIGNUP=${ENABLE_SIGNUP}'
      - 'ENABLE_EMAIL_PASSWORD=${ENABLE_EMAIL_PASSWORD}'
      - 'ENABLE_MAGIC_LINK_LOGIN=${ENABLE_MAGIC_LINK_LOGIN}'
      - 'SECRET_KEY=${SECRET_KEY}'
      - 'USE_MINIO=${USE_MINIO}'
      - 'AWS_REGION=${AWS_REGION}'
      - 'AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}'
      - 'AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}'
      - 'AWS_S3_ENDPOINT_URL=${AWS_S3_ENDPOINT_URL}'
      - 'AWS_S3_BUCKET_NAME=${AWS_S3_BUCKET_NAME}'
      - 'MINIO_ROOT_USER=${MINIO_ROOT_USER}'
      - 'MINIO_ROOT_PASSWORD=${MINIO_ROOT_PASSWORD}'
      - 'BUCKET_NAME=${BUCKET_NAME}'
      - 'FILE_SIZE_LIMIT=${FILE_SIZE_LIMIT}'
    image: 'postgres:15.2-alpine'
    pull_policy: if_not_present
    restart: unless-stopped
    command: "postgres -c 'max_connections=1000'"
    volumes:
      - 'pgdata:/var/lib/postgresql/data'
  plane-redis:
    environment:
      - 'NGINX_PORT=${NGINX_PORT}'
      - 'WEB_URL=${WEB_URL}'
      - 'DEBUG=${DEBUG}'
      - 'DJANGO_SETTINGS_MODULE=${DJANGO_SETTINGS_MODULE}'
      - 'NEXT_PUBLIC_DEPLOY_URL=${NEXT_PUBLIC_DEPLOY_URL}'
      - 'SENTRY_DSN=${SENTRY_DSN}'
      - 'SENTRY_ENVIRONMENT=${SENTRY_ENVIRONMENT}'
      - 'GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}'
      - 'GITHUB_CLIENT_ID=${GITHUB_CLIENT_ID}'
      - 'GITHUB_CLIENT_SECRET=${GITHUB_CLIENT_SECRET}'
      - 'DOCKERIZED=${DOCKERIZED}'
      - 'CORS_ALLOWED_ORIGINS=${CORS_ALLOWED_ORIGINS}'
      - 'GUNICORN_WORKERS=${GUNICORN_WORKERS}'
      - 'PGHOST=${PGHOST}'
      - 'PGDATABASE=${PGDATABASE}'
      - 'POSTGRES_USER=${POSTGRES_USER}'
      - 'POSTGRES_PASSWORD=${POSTGRES_PASSWORD}'
      - 'POSTGRES_DB=${POSTGRES_DB}'
      - 'PGDATA=${PGDATA}'
      - 'DATABASE_URL=${DATABASE_URL}'
      - 'REDIS_HOST=${REDIS_HOST}'
      - 'REDIS_PORT=${REDIS_PORT}'
      - 'REDIS_URL=${REDIS_URL}'
      - 'EMAIL_HOST=${EMAIL_HOST}'
      - 'EMAIL_HOST_USER=${EMAIL_HOST_USER}'
      - 'EMAIL_HOST_PASSWORD=${EMAIL_HOST_PASSWORD}'
      - 'EMAIL_PORT=${EMAIL_PORT}'
      - 'EMAIL_FROM=${EMAIL_FROM}'
      - 'EMAIL_USE_TLS=${EMAIL_USE_TLS}'
      - 'EMAIL_USE_SSL=${EMAIL_USE_SSL}'
      - 'DEFAULT_EMAIL=${DEFAULT_EMAIL}'
      - 'DEFAULT_PASSWORD=${DEFAULT_PASSWORD}'
      - 'OPENAI_API_BASE=${OPENAI_API_BASE}'
      - 'OPENAI_API_KEY=${OPENAI_API_KEY}'
      - 'GPT_ENGINE=${GPT_ENGINE}'
      - 'ENABLE_SIGNUP=${ENABLE_SIGNUP}'
      - 'ENABLE_EMAIL_PASSWORD=${ENABLE_EMAIL_PASSWORD}'
      - 'ENABLE_MAGIC_LINK_LOGIN=${ENABLE_MAGIC_LINK_LOGIN}'
      - 'SECRET_KEY=${SECRET_KEY}'
      - 'USE_MINIO=${USE_MINIO}'
      - 'AWS_REGION=${AWS_REGION}'
      - 'AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}'
      - 'AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}'
      - 'AWS_S3_ENDPOINT_URL=${AWS_S3_ENDPOINT_URL}'
      - 'AWS_S3_BUCKET_NAME=${AWS_S3_BUCKET_NAME}'
      - 'MINIO_ROOT_USER=${MINIO_ROOT_USER}'
      - 'MINIO_ROOT_PASSWORD=${MINIO_ROOT_PASSWORD}'
      - 'BUCKET_NAME=${BUCKET_NAME}'
      - 'FILE_SIZE_LIMIT=${FILE_SIZE_LIMIT}'
    image: 'redis:6.2.7-alpine'
    pull_policy: if_not_present
    restart: unless-stopped
    volumes:
      - 'redisdata:/data'
  plane-minio:
    environment:
      - 'NGINX_PORT=${NGINX_PORT}'
      - 'WEB_URL=${WEB_URL}'
      - 'DEBUG=${DEBUG}'
      - 'DJANGO_SETTINGS_MODULE=${DJANGO_SETTINGS_MODULE}'
      - 'NEXT_PUBLIC_DEPLOY_URL=${NEXT_PUBLIC_DEPLOY_URL}'
      - 'SENTRY_DSN=${SENTRY_DSN}'
      - 'SENTRY_ENVIRONMENT=${SENTRY_ENVIRONMENT}'
      - 'GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}'
      - 'GITHUB_CLIENT_ID=${GITHUB_CLIENT_ID}'
      - 'GITHUB_CLIENT_SECRET=${GITHUB_CLIENT_SECRET}'
      - 'DOCKERIZED=${DOCKERIZED}'
      - 'CORS_ALLOWED_ORIGINS=${CORS_ALLOWED_ORIGINS}'
      - 'GUNICORN_WORKERS=${GUNICORN_WORKERS}'
      - 'PGHOST=${PGHOST}'
      - 'PGDATABASE=${PGDATABASE}'
      - 'POSTGRES_USER=${POSTGRES_USER}'
      - 'POSTGRES_PASSWORD=${POSTGRES_PASSWORD}'
      - 'POSTGRES_DB=${POSTGRES_DB}'
      - 'PGDATA=${PGDATA}'
      - 'DATABASE_URL=${DATABASE_URL}'
      - 'REDIS_HOST=${REDIS_HOST}'
      - 'REDIS_PORT=${REDIS_PORT}'
      - 'REDIS_URL=${REDIS_URL}'
      - 'EMAIL_HOST=${EMAIL_HOST}'
      - 'EMAIL_HOST_USER=${EMAIL_HOST_USER}'
      - 'EMAIL_HOST_PASSWORD=${EMAIL_HOST_PASSWORD}'
      - 'EMAIL_PORT=${EMAIL_PORT}'
      - 'EMAIL_FROM=${EMAIL_FROM}'
      - 'EMAIL_USE_TLS=${EMAIL_USE_TLS}'
      - 'EMAIL_USE_SSL=${EMAIL_USE_SSL}'
      - 'DEFAULT_EMAIL=${DEFAULT_EMAIL}'
      - 'DEFAULT_PASSWORD=${DEFAULT_PASSWORD}'
      - 'OPENAI_API_BASE=${OPENAI_API_BASE}'
      - 'OPENAI_API_KEY=${OPENAI_API_KEY}'
      - 'GPT_ENGINE=${GPT_ENGINE}'
      - 'ENABLE_SIGNUP=${ENABLE_SIGNUP}'
      - 'ENABLE_EMAIL_PASSWORD=${ENABLE_EMAIL_PASSWORD}'
      - 'ENABLE_MAGIC_LINK_LOGIN=${ENABLE_MAGIC_LINK_LOGIN}'
      - 'SECRET_KEY=${SECRET_KEY}'
      - 'USE_MINIO=${USE_MINIO}'
      - 'AWS_REGION=${AWS_REGION}'
      - 'AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}'
      - 'AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}'
      - 'AWS_S3_ENDPOINT_URL=${AWS_S3_ENDPOINT_URL}'
      - 'AWS_S3_BUCKET_NAME=${AWS_S3_BUCKET_NAME}'
      - 'MINIO_ROOT_USER=${MINIO_ROOT_USER}'
      - 'MINIO_ROOT_PASSWORD=${MINIO_ROOT_PASSWORD}'
      - 'BUCKET_NAME=${BUCKET_NAME}'
      - 'FILE_SIZE_LIMIT=${FILE_SIZE_LIMIT}'
    image: 'quay.io/minio/minio:RELEASE.2023-11-01T01-57-10Z-cpuv1'
    pull_policy: if_not_present
    restart: unless-stopped
    command: 'server /export --console-address ":9090"'
    volumes:
      - 'uploads:/export'
volumes:
  pgdata: null
  redisdata: null
  uploads: null
